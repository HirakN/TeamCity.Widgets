<!--
  ~ Copyright 2000-2015 JetBrains s.r.o.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<dom-module id="nested-to-flat">
    <script>
        // element registration
        Polymer({
            is: "nested-to-flat",
            properties: {
                flatData: {
                    type: Object,
                    observer: "_flatDataChanged"
                },
                dataTree: {
                    type: Object,
                    notify: true,
                    observer: "_dataTreeChanged"
                },
                index: {
                    type: Number
                }
            },
            _flatDataChanged: function (value){
                this.fire('flatDataChanged', {flatData: value});
            },
            _dataTreeChanged: function (){
                var d = [];
                this.index = 0;
                this._visitDfs(this.dataTree[0], 0, function(node){
                      d.push(node);
                });
                this.flatData = d;
            },
            _visitDfs: function(node, level, func){
                var self = this;
                var listNode = {level: level, text: node.text, type: (node.buildType?'buildType':'project'), index: this.index};

                if (func) {
                    func(listNode);
                }

                this.index++;

                if (node.children==undefined) {
                    return;
                }
                node.children.forEach(function (child) {
                    self._visitDfs(child, level+1, func);
                });
            },
            _visitBfs: function(node, func) {
                var q = [node];
                while (q.length > 0) {
                    node = q.shift();
                    if (func) {
                        func(node);
                    }
                    if (node.children==undefined) {
                        return;
                    }
                    node.children.forEach(function (child) {
                        q.push(child);
                    });
                }
        }
        });
    </script>
</dom-module>