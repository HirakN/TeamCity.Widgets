<link rel="import" href="teamcity-search.html">
<link rel="import" href="teamcity-server.html">
<link rel="import" href="project-list-wrapper.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<script type="text/javascript" src="../bower_components/uri.js/src/URI.min.js"></script>
<dom-module id="search-container">
    <template>
        <style>
            label{
                cursor: pointer;
            }
            #serversHolder{
                background-color: white;
                width: 300px;
                min-height: 100px;
                margin-left: 20px;
                padding-left: 10px;
                padding-top: 5px;
            }
            #resultsHolder{
                width: 413px;
            }
        </style>

        <div style="width: 100%; text-align: center; margin-bottom: 25px;">
            <teamcity-search></teamcity-search>
        </div>
        <div class="horizontal layout wrap center-justified">
            <div id="resultsHolder">
                <project-list-wrapper></project-list-wrapper>
            </div>
            <div id="serversHolder" class="vertical layout">

            </div>
        </div>
    </template>

    <script>
        Polymer({
            is: "search-container",
            properties: {
                servers: {
                    type: Array,
                    value: [],
                    notify: true
                },
                aggregateData:{
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },
            behaviors: [LoggingBehavior],
            ready: function(){
                var params = URI(document.location.href).search(true);
                var servers = params["server"];

                if (servers != undefined){
                    this._applyDataFromUrl(servers);
                }

                var serversHolder = this.$.serversHolder;

                this.debug('servers: ' + this.servers);
                this.debug('serversHolder: ' + serversHolder);

                var self = this;
                this.servers.forEach(function(s){
                    var ts = document.createElement("teamcity-server");
                    ts.server = s;
                    self.debug('teamcity-server will be added for: ' + s);
                    serversHolder.appendChild(ts);
                });
            },
            _applyDataFromUrl: function(servers){
                this.debug('Data from URL will be applied: ' + servers);
                if (Array.isArray(servers)){
                    this.servers = servers;
                } else {
                    this.servers = [servers];
                }
            },
            _aggregateDataChanged: function(value){
                this.aggregateData = this.$.aggregateDataSetting.checked;
            }
        });
    </script>
</dom-module>