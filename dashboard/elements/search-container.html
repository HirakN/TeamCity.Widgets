<link rel="import" href="server-view.html">
<link rel="import" href="teamcity-search.html">
<link rel="import" href="multi-server-view.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<script type="text/javascript" src="../bower_components/uri.js/src/URI.min.js"></script>
<dom-module id="search-container">
    <template>
        <style>
            label{
                cursor: pointer;
            }
        </style>
        <teamcity-search></teamcity-search>
        <div style="width: 100%; text-align: center;">
            <input id="aggregateDataSetting" is="iron-input" type="checkbox" checked="{{aggregateData}}" on-change="_aggregateDataChanged"/>
            <label for="aggregateDataSetting">Show data from all servers in one tree</label>
        </div>
        <template is="dom-if" if="{{!aggregateData}}">
                <div class="horizontal layout wrap center-justified">
                    <template is="dom-repeat" items="{{servers}}" as="server">
                        <div style="align-self: flex-start;">
                            <server-view server="{{server}}"></server-view>
                        </div>
                    </template>
                </div>
        </template>
        <template is="dom-if" if="{{aggregateData}}">
                <multi-server-view servers="{{servers}}"></multi-server-view>
        </template>
    </template>
    <script>
        Polymer({
            is: "search-container",
            properties: {
                servers: {
                    type: Array,
                    value: [],
                    notify: true
                },
                aggregateData:{
                    type: Boolean,
                    value: false,
                    notify: true
                }
            },
            ready: function(){
                console.log(this.servers);
                var params = URI(document.location.href).search(true);
                var servers = params["server"];

                if (servers == undefined && this.servers.length > 0){
                    return;
                }
                if (servers == undefined && this.servers.length){
                    console.log("No servers URL are provided. Ensure you pass the parameters to the URL, e.g. server=http://server1.com&server=http://server2.com");
                    return;
                }
                if (Array.isArray(servers)){
                    this.servers = servers;
                } else {
                    this.servers = [servers];
                }
            },
            _aggregateDataChanged: function(value){
                this.aggregateData = this.$.aggregateDataSetting.checked;
            }
        });
    </script>
</dom-module>